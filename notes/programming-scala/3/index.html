<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Scala 的层级 #  Scala 继承层级 #  Any 类定义了以下的方法：
final def ==(that: Any): Boolean final def !=(that: Any): Boolean def equals(that: Any): Boolean def hashCode: Int def toString: String 其中 == != 方法是 final 的，它们的取值取决于 equals 方法。因此，Scala 中可以使用 == 来比较 Integer String 和其他对象。
Any 有两个子类：AnyVal AnyRef。其中 AnyVal 有九个子类，包括 Java 的八种基本类型和 Unit。这些类都不能用 new 来创建，而必须使用字面量。实际上，这些类都是 abstract final 的，所以无法使用 new。Unit 则只有一个值，写作 ()。
AnyVal 的子类被称为值类型，它们之间可以隐式地互相转换。之前提到过，它们还可以隐式地转换为对应的 Rich 类以支持 until range max 等更多操作。值类型在编译之后将会变成基本类型而不是他们对应的装箱类型，这样做能够带来一些性能提升。Scala 在这里做的事情和 Java 5 的自动装箱很相似。另外一个类 AnyRef 实际上就是 java."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="3 .Inheritance, Package, Assertion"><meta property="og:description" content="Scala 的层级 #  Scala 继承层级 #  Any 类定义了以下的方法：
final def ==(that: Any): Boolean final def !=(that: Any): Boolean def equals(that: Any): Boolean def hashCode: Int def toString: String 其中 == != 方法是 final 的，它们的取值取决于 equals 方法。因此，Scala 中可以使用 == 来比较 Integer String 和其他对象。
Any 有两个子类：AnyVal AnyRef。其中 AnyVal 有九个子类，包括 Java 的八种基本类型和 Unit。这些类都不能用 new 来创建，而必须使用字面量。实际上，这些类都是 abstract final 的，所以无法使用 new。Unit 则只有一个值，写作 ()。
AnyVal 的子类被称为值类型，它们之间可以隐式地互相转换。之前提到过，它们还可以隐式地转换为对应的 Rich 类以支持 until range max 等更多操作。值类型在编译之后将会变成基本类型而不是他们对应的装箱类型，这样做能够带来一些性能提升。Scala 在这里做的事情和 Java 5 的自动装箱很相似。另外一个类 AnyRef 实际上就是 java."><meta property="og:type" content="article"><meta property="og:url" content="/notes/programming-scala/3/"><meta property="article:section" content="notes"><title>3 .Inheritance, Package, Assertion | czdm75 Blog</title><link rel=manifest href=/manifest.json><link rel=icon href=/favicon.png type=image/x-icon><link rel=stylesheet href=/book.min.97cfda4f5e3c9fa49a2bf8d401f4ddc0eec576c99cdcf6afbec19173200c37db.css><script defer src=/flexsearch.min.js></script>
<script defer src=/en.search.min.60f5c0362a1b15384bf6fbb748ad6fb49d79819ad4313fc4618ffb6d1f645f15.js></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>czdm75 Blog</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><input type=checkbox id=section-25b8c894ab868b34ecd6cce0ce4c79c7 class=toggle>
<label for=section-25b8c894ab868b34ecd6cce0ce4c79c7 class="flex justify-between"><a href=/cs/>Computer Science</a></label><ul><li><a href=/cs/linux-io-multiplex/>Linux IO Multiplexing</a></li></ul></li><li><input type=checkbox id=section-d5643d9c227c9fc0bfaa81dc6e0249af class=toggle>
<label for=section-d5643d9c227c9fc0bfaa81dc6e0249af class="flex justify-between"><a href=/distributed/>Distributed Systems</a></label><ul><li><a href=/distributed/hadoop-basic/>Hadoop Basic Concepts</a></li><li><a href=/distributed/spark-rdd/>Spark RDD Programming</a></li><li><a href=/distributed/spark-sql/>Spark SQL Programming</a></li></ul></li><li><a href=/notes/>Notes on Books</a><ul><li><input type=checkbox id=section-f9c54ee28ad742882651b9afb106f923 class=toggle>
<label for=section-f9c54ee28ad742882651b9afb106f923 class="flex justify-between"><a href=/notes/core-java-impatient/>Core Java for Impatients</a></label><ul><li><a href=/notes/core-java-impatient/1/>1. Basic OOP</a></li><li><a href=/notes/core-java-impatient/2/>2. Interface, Lambda</a></li><li><a href=/notes/core-java-impatient/3/>3. Inheritance, Reflection</a></li><li><a href=/notes/core-java-impatient/4/>4. Exception, Logging</a></li><li><a href=/notes/core-java-impatient/5/>5. Generics</a></li><li><a href=/notes/core-java-impatient/6/>6. Collections, Streams</a></li><li><a href=/notes/core-java-impatient/7/>7. IO, Regexp, Serialization</a></li><li><a href=/notes/core-java-impatient/8/>8. Threading</a></li><li><a href=/notes/core-java-impatient/9/>9. Notations</a></li></ul></li><li><input type=checkbox id=section-9d0fb26a4934bb77406a56b94138590b class=toggle>
<label for=section-9d0fb26a4934bb77406a56b94138590b class="flex justify-between"><a href=/notes/in-depth-jvm/>In-depth Understanding JVM</a></label><ul><li><a href=/notes/in-depth-jvm/gc/>Garbage Collection</a></li><li><a href=/notes/in-depth-jvm/synchronization/>Java Synchronization</a></li><li><a href=/notes/in-depth-jvm/memory-model/>JVM Memory Model</a></li><li><a href=/notes/in-depth-jvm/memory-region/>JVM Memory Regions</a></li><li><a href=/notes/in-depth-jvm/threadlocal-reference/>ThreadLocal and Reference</a></li></ul></li><li><input type=checkbox id=section-4d028229be962782539eef651433109e class=toggle>
<label for=section-4d028229be962782539eef651433109e class="flex justify-between"><a href=/notes/intro-algo/>Introduction to Algorithms</a></label><ul><li><a href=/notes/intro-algo/1/>1. Compexity, Divide</a></li><li><a href=/notes/intro-algo/2/>2. Sorting, Order Statistic</a></li><li><a href=/notes/intro-algo/3/>3. LinkedList, HashTable</a></li><li><a href=/notes/intro-algo/4/>4. BST, Balanced BSTs</a></li><li><a href=/notes/intro-algo/5/>5. Trie-Tree, Extending Data Structures</a></li><li><a href=/notes/intro-algo/6/>6. Dynamic Programming, Greedy, Amortize</a></li><li><a href=/notes/intro-algo/7/>7. B-Tree, Fibonacci Heap, vEB Tree</a></li><li><a href=/notes/intro-algo/8/>8. Graphs</a></li></ul></li><li><input type=checkbox id=section-76be9453a58f37863458b83352d3ff3c class=toggle checked>
<label for=section-76be9453a58f37863458b83352d3ff3c class="flex justify-between"><a href=/notes/programming-scala/>Programming in Scala</a></label><ul><li><a href=/notes/programming-scala/1/>1. Basics</a></li><li><a href=/notes/programming-scala/2/>2. Functions</a></li><li><a href=/notes/programming-scala/3/ class=active>3 .Inheritance, Package, Assertion</a></li><li><a href=/notes/programming-scala/4/>4. Pattern Matching, Collections</a></li><li><a href=/notes/programming-scala/5/>5. Generics, Abstract, Implicits</a></li><li><a href=/notes/programming-scala/6/>6. Collections, Extractor, etc</a></li></ul></li></ul></li><li><input type=checkbox id=section-9784d97422a8bbe41d06f74a08150515 class=toggle>
<label for=section-9784d97422a8bbe41d06f74a08150515 class="flex justify-between"><a href=/pl/>Programming Languages</a></label><ul><li><a href=/pl/java-nio-2/>Java NIO Internal</a></li><li><a href=/pl/java-nio-1/>Java NIO Usage</a></li><li><a href=/pl/lambda/>Lambda Calculus and Y Combinator</a></li><li><a href=/pl/curry/>Scala: Currying, Partially Applied, Partial</a></li><li><a href=/pl/monad/>Scala: Monad, from Scala Perspective</a></li></ul></li></ul><ul><li><a href=https://github.com/czdm75 target=_blank rel=noopener>GitHub</a></li><li><a href=https://themes.gohugo.io/hugo-book/ target=_blank rel=noopener>Theme</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label>
<strong>3 .Inheritance, Package, Assertion</strong>
<label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#scala-的层级>Scala 的层级</a><ul><li><a href=#scala-继承层级>Scala 继承层级</a></li><li><a href=#自定义值类型>自定义值类型</a></li><li><a href=#相等性>相等性</a></li></ul></li><li><a href=#特质-trait>特质 Trait</a><ul><li><a href=#trait>Trait</a></li><li><a href=#瘦接口-vs-胖接口>瘦接口 VS 胖接口</a></li><li><a href=#混入>混入</a></li><li><a href=#细节和使用>细节和使用</a></li><li><a href=#线性化规则>线性化规则</a></li></ul></li><li><a href=#包和访问>包和访问</a><ul><li><a href=#包>包</a></li><li><a href=#引入>引入</a></li><li><a href=#访问控制>访问控制</a></li></ul></li><li><a href=#断言>断言</a></li></ul></nav></aside></header><article class=markdown><h1 id=scala-的层级>Scala 的层级
<a class=anchor href=#scala-%e7%9a%84%e5%b1%82%e7%ba%a7>#</a></h1><h2 id=scala-继承层级>Scala 继承层级
<a class=anchor href=#scala-%e7%bb%a7%e6%89%bf%e5%b1%82%e7%ba%a7>#</a></h2><p><code>Any</code> 类定义了以下的方法：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>final</span> <span style=color:green;font-weight:700>def</span> <span style=color:#666>==(</span>that<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Any</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>final</span> <span style=color:green;font-weight:700>def</span> <span style=color:#666>!=(</span>that<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Any</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>def</span> equals<span style=color:#666>(</span>that<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Any</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>def</span> hashCode<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>def</span> toString<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span>
</span></span></code></pre></div><p>其中 <code>==</code> <code>!=</code> 方法是 <code>final</code> 的，它们的取值取决于 <code>equals</code> 方法。因此，Scala 中可以使用 <code>==</code> 来比较 <code>Integer</code> <code>String</code> 和其他对象。</p><p><code>Any</code> 有两个子类：<code>AnyVal</code> <code>AnyRef</code>。其中 <code>AnyVal</code> 有九个子类，包括 Java 的八种基本类型和 <code>Unit</code>。这些类都不能用 <code>new</code> 来创建，而必须使用字面量。实际上，这些类都是 <code>abstract final</code> 的，所以无法使用 <code>new</code>。<code>Unit</code> 则只有一个值，写作 <code>()</code>。</p><p><img src=../class-hierarchy.png alt=Scala类继承层级></p><p><code>AnyVal</code> 的子类被称为值类型，它们之间可以隐式地互相转换。之前提到过，它们还可以隐式地转换为对应的 <code>Rich</code> 类以支持 <code>until</code> <code>range</code> <code>max</code> 等更多操作。值类型在编译之后将会变成基本类型而不是他们对应的装箱类型，这样做能够带来一些性能提升。Scala 在这里做的事情和 Java 5 的自动装箱很相似。另外一个类 <code>AnyRef</code> 实际上就是 <code>java.lang.Object</code>。</p><p>在整个继承树的底端是 <code>scala.Nothing</code> 和 <code>scala.Null</code>。<code>Null</code> 类有一个实例，即 <code>null</code>，也就是空引用，而 <code>Nothing</code> 则没有值。这样做的目的是为类型推导提供方便。二者的主要区别是，<code>Null</code> 仅包括了 <code>AnyRef</code> 的子类（某种意义上的引用类型），<code>Nothing</code> 包括值类型。以及，<code>Null</code> 有一个实例。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#666>{</span> x<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span> <span style=color:#666>=&gt;</span> <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>x <span style=color:#666>==</span> <span style=color:#666>0</span><span style=color:#666>)</span> <span style=color:#ba2121>&#34;zero&#34;</span> <span style=color:green;font-weight:700>else</span> <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>Exception</span> <span style=color:#666>}</span>  <span style=color:#408080;font-style:italic>// Int =&gt; String
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:#666>{</span> x<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span> <span style=color:#666>=&gt;</span> <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>x <span style=color:#666>==</span> <span style=color:#666>0</span><span style=color:#666>)</span> <span style=color:#ba2121>&#34;zero&#34;</span> <span style=color:green;font-weight:700>else</span> <span style=color:green;font-weight:700>null</span> <span style=color:#666>}</span>                 <span style=color:#408080;font-style:italic>// Int =&gt; String
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:#666>{</span> x<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span> <span style=color:#666>=&gt;</span> <span style=color:green;font-weight:700>if</span> <span style=color:#666>(</span>x <span style=color:#666>==</span> <span style=color:#666>0</span><span style=color:#666>)</span> <span style=color:#ba2121>&#34;zero&#34;</span> <span style=color:green;font-weight:700>else</span> <span style=color:#666>1</span> <span style=color:#666>}</span>                    <span style=color:#408080;font-style:italic>// Int =&gt; Any
</span></span></span></code></pre></div><h2 id=自定义值类型>自定义值类型
<a class=anchor href=#%e8%87%aa%e5%ae%9a%e4%b9%89%e5%80%bc%e7%b1%bb%e5%9e%8b>#</a></h2><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Dollars</span><span style=color:#666>(</span><span style=color:green;font-weight:700>val</span> amount<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>AnyVal</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>override</span> <span style=color:green;font-weight:700>def</span> toString<span style=color:#666>()</span> <span style=color:green;font-weight:700>=</span> <span style=color:#ba2121>&#34;$&#34;</span> <span style=color:#666>+</span> amount
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span></code></pre></div><p>值类型可以让代码更加清晰，减少错误。考虑这样一段关于 <code>HTML</code> 的代码：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>def</span> title<span style=color:#666>(</span>text<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>,</span> anchor<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>,</span> style<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span> <span style=color:#666>=</span>
</span></span><span style=display:flex><span>  <span style=color:#ba2121>s&#34;&lt;a id=&#39;</span><span style=color:#b68;font-weight:700>$anchor</span><span style=color:#ba2121>&#39;&gt;&lt;h1 class=&#39;</span><span style=color:#b68;font-weight:700>$style</span><span style=color:#ba2121>&#39;&gt;</span><span style=color:#b68;font-weight:700>$text</span><span style=color:#ba2121>&lt;/h1&gt;&lt;/a&gt;&#34;</span>
</span></span></code></pre></div><p>四个参数都是 <code>String</code>，有人称这种代码为 Stringly Typed。因为字符串之间没有区别，这段代码实际上和弱类型语言并没有本质区别，编译器也不能帮我们检查错误。如果使用短小的值类型，就能解决这种问题：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Anchor</span><span style=color:#666>(</span><span style=color:green;font-weight:700>val</span> value<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>AnyVal</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Style</span><span style=color:#666>(</span><span style=color:green;font-weight:700>val</span> value<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>AnyVal</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Text</span><span style=color:#666>(</span><span style=color:green;font-weight:700>val</span> value<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>AnyVal</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Html</span><span style=color:#666>(</span><span style=color:green;font-weight:700>val</span> value<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>AnyVal</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>def</span> title<span style=color:#666>(</span>text<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Text</span><span style=color:#666>,</span> anchor<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Anchor</span><span style=color:#666>,</span> style<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Style</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Html</span> <span style=color:#666>=</span> <span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>Html</span><span style=color:#666>(</span>
</span></span><span style=display:flex><span>  <span style=color:#ba2121>s&#34;&lt;a id=&#39;</span><span style=color:#b68;font-weight:700>${</span>anchor<span style=color:#666>.</span>value<span style=color:#b68;font-weight:700>}</span><span style=color:#ba2121>&#39;&gt;&lt;h1 class=&#39;</span><span style=color:#b68;font-weight:700>${</span>style<span style=color:#666>.</span>value<span style=color:#b68;font-weight:700>}</span><span style=color:#ba2121>&#39;&gt;text.value&lt;/h1&gt;&lt;/a&gt;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#666>)</span>
</span></span></code></pre></div><h2 id=相等性>相等性
<a class=anchor href=#%e7%9b%b8%e7%ad%89%e6%80%a7>#</a></h2><p>因为 Scala 将 <code>==</code> 和 <code>equals</code> 统一起来，所以 <code>AnyRef</code> 定义了 <code>eq</code> 方法用于两个引用的直接比较。类似地，还有一个相反的方法名为 <code>ne</code>。有关相等性在 30 章还会有更多讨论。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#ba2121>&#34;abc&#34;</span> <span style=color:#666>==</span> <span style=color:green;font-weight:700>new</span> String<span style=color:#666>(</span><span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>)</span>       <span style=color:#408080;font-style:italic>// false
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>.</span><span style=color:#7d9029>equals</span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> String<span style=color:#666>(</span><span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>))</span>  <span style=color:#408080;font-style:italic>// true
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>String</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>)</span> <span style=color:#666>==</span> <span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>String</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>)</span>  <span style=color:#408080;font-style:italic>// true
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>String</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>)</span> eq <span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>String</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>)</span>  <span style=color:#408080;font-style:italic>// false
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>// warning: comparing a fresh object using `eq&#39; will always yield false
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>//   new String(&#34;abc&#34;) eq new String(&#34;abc&#34;)
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>//                     ^
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>scala <span style=color:#666>&gt;</span> <span style=color:#ba2121>&#34;abc&#34;</span> eq <span style=color:#ba2121>&#34;abc&#34;</span>  <span style=color:#408080;font-style:italic>// true,  because of hash consing
</span></span></span></code></pre></div><p>这个原则的唯一例外是 Java 装箱类型。在 Java 中，能够互相转换的对象的 <code>equals</code> 结果仍然是 <code>false</code>。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span>java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Integer</span><span style=color:#666>.</span>valueOf<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span> equals java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Long</span><span style=color:#666>.</span>valueOf<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span>  <span style=color:#408080;font-style:italic>// false
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Integer</span><span style=color:#666>.</span>valueOf<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span> <span style=color:#666>==</span> java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Long</span><span style=color:#666>.</span>valueOf<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span>      <span style=color:#408080;font-style:italic>// true
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Integer</span><span style=color:#666>.</span>valueOf<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span> eq java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Long</span><span style=color:#666>.</span>valueOf<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span>      <span style=color:#408080;font-style:italic>// false
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>
</span></span><span style=display:flex><span>java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Integer</span><span style=color:#666>.</span>valueOf<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span> equals <span style=color:green;font-weight:700>new</span> java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Integer</span><span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span>   <span style=color:#408080;font-style:italic>// true
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Integer</span><span style=color:#666>.</span>valueOf<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span> <span style=color:#666>==</span> <span style=color:green;font-weight:700>new</span> java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Integer</span><span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span>       <span style=color:#408080;font-style:italic>// true
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Integer</span><span style=color:#666>.</span>valueOf<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span> eq <span style=color:green;font-weight:700>new</span> java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Integer</span><span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>)</span>       <span style=color:#408080;font-style:italic>// false
</span></span></span></code></pre></div><p>而对于 <code>Int</code> 来说，因为是值类型，不能进行 <code>eq</code> 比较。</p><h1 id=特质-trait>特质 Trait
<a class=anchor href=#%e7%89%b9%e8%b4%a8-trait>#</a></h1><h2 id=trait>Trait
<a class=anchor href=#trait>#</a></h2><p>Trait 和 Java 的接口的最大差别是我们混入（mix in）Trait 而不是实现接口。混入一个 trait 有两种方式：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>A</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>T</span> <span style=color:green;font-weight:700>extends</span> A
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>object</span> <span style=color:#00f;font-weight:700>O</span> <span style=color:green;font-weight:700>extends</span> T
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>val</span> v<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span> <span style=color:#666>=</span> O
</span></span></code></pre></div><p>如果使用 <code>extends</code> 关键字，那么新的对象就会继承于 trait 的父类。如果 trait 没有显式继承，那么这个对象理所当然地会继承于 <code>AnyRef</code>。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>Tr</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>object</span> <span style=color:#00f;font-weight:700>Obj</span> <span style=color:green;font-weight:700>extends</span> A <span style=color:green;font-weight:700>with</span> T <span style=color:green;font-weight:700>with</span> <span style=color:#00f;font-weight:700>Tr</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>val</span> v<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>T</span> <span style=color:#666>=</span> <span style=color:#00f;font-weight:700>Obj</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>val</span> v<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span> <span style=color:#666>=</span> <span style=color:#00f;font-weight:700>Obj</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>val</span> v<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Tr</span> <span style=color:#666>=</span> <span style=color:#00f;font-weight:700>Obj</span>
</span></span></code></pre></div><h2 id=瘦接口-vs-胖接口>瘦接口 VS 胖接口
<a class=anchor href=#%e7%98%a6%e6%8e%a5%e5%8f%a3-vs-%e8%83%96%e6%8e%a5%e5%8f%a3>#</a></h2><p>在 Java 8 之前，Java 世界通常使用的是瘦接口。例如，虽然 String 的大部分方法都可以用于任何字符序列，<code>CharSequence</code> 接口提供的仍然很少。在没有默认方法的情况下，实现一个胖接口是一件十分累人的工作。在 Java 8 引入默认方法之前，这个接口只有四个方法：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>interface</span> <span style=color:#00f;font-weight:700>CharSequence</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>    <span style=color:#b00040>int</span> <span style=color:#00f>length</span><span style=color:#666>();</span>
</span></span><span style=display:flex><span>    <span style=color:#b00040>char</span> <span style=color:#00f>charAt</span><span style=color:#666>(</span><span style=color:#b00040>int</span> index<span style=color:#666>);</span>
</span></span><span style=display:flex><span>    CharSequence <span style=color:#00f>subSequence</span><span style=color:#666>(</span><span style=color:#b00040>int</span> start<span style=color:#666>,</span> <span style=color:#b00040>int</span> end<span style=color:#666>);</span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>public</span> String <span style=color:#00f>toString</span><span style=color:#666>();</span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>default</span> IntStream <span style=color:#00f>chars</span><span style=color:#666>()</span> <span style=color:#666>{...}</span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>default</span> IntStream <span style=color:#00f>codePoints</span><span style=color:#666>()</span> <span style=color:#666>{...}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span></code></pre></div><p>由于历史原因，即使到了 Java 8，为了与旧库的兼容，我们也不敢再贸然加入太多的新默认方法了。Java 世界的常规做法是定义一个抽象类来加入 Java 8 的默认方法所做的事情，再继承，但这样又失去了定义接口的意义。在 Scala 中，你只需要实现 <code>compare</code>，就能得到一系列方法：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>Ordered</span><span style=color:#666>[</span><span style=color:#b00040>A</span><span style=color:#666>]</span> <span style=color:#00f;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>Any</span> <span style=color:green;font-weight:700>with</span> java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>Comparable</span><span style=color:#666>[</span><span style=color:#b00040>A</span><span style=color:#666>]</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> compare<span style=color:#666>(</span>that<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> <span style=color:#666>&lt;</span>  <span style=color:#666>(</span>that<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span> <span style=color:#666>=</span> <span style=color:#666>(</span><span style=color:green;font-weight:700>this</span> compare that<span style=color:#666>)</span> <span style=color:#666>&lt;</span>  <span style=color:#666>0</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> <span style=color:#666>&gt;</span>  <span style=color:#666>(</span>that<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span> <span style=color:#666>=</span> <span style=color:#666>(</span><span style=color:green;font-weight:700>this</span> compare that<span style=color:#666>)</span> <span style=color:#666>&gt;</span>  <span style=color:#666>0</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> <span style=color:#666>&lt;=</span> <span style=color:#666>(</span>that<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span> <span style=color:#666>=</span> <span style=color:#666>(</span><span style=color:green;font-weight:700>this</span> compare that<span style=color:#666>)</span> <span style=color:#666>&lt;=</span> <span style=color:#666>0</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> <span style=color:#666>&gt;=</span> <span style=color:#666>(</span>that<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span> <span style=color:#666>=</span> <span style=color:#666>(</span><span style=color:green;font-weight:700>this</span> compare that<span style=color:#666>)</span> <span style=color:#666>&gt;=</span> <span style=color:#666>0</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> compareTo<span style=color:#666>(</span>that<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span> <span style=color:#666>=</span> compare<span style=color:#666>(</span>that<span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span></code></pre></div><h2 id=混入>混入
<a class=anchor href=#%e6%b7%b7%e5%85%a5>#</a></h2><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>A</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>def</span> f<span style=color:#666>(</span>s<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>=</span> print<span style=color:#666>(</span>s <span style=color:#666>+</span> <span style=color:#ba2121>&#34; from class A&#34;</span><span style=color:#666>)</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>B</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>C</span> <span style=color:green;font-weight:700>extends</span> A <span style=color:#666>{</span> <span style=color:green;font-weight:700>override</span> <span style=color:green;font-weight:700>def</span> f<span style=color:#666>(</span>s<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>=</span> <span style=color:green;font-weight:700>super</span><span style=color:#666>.</span>f<span style=color:#666>(</span>s <span style=color:#666>+</span> <span style=color:#ba2121>&#34; from trait C&#34;</span><span style=color:#666>)</span> <span style=color:#666>}</span>
</span></span></code></pre></div><p>这样编写特质之后，我们发现的第一件事是，因为我们在 <code>C</code> 的定义中明确了 <code>A</code>，所以 <code>B</code> 不能混入 <code>C</code>，因为它不是 <code>A</code> 的子类。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>D</span> <span style=color:green;font-weight:700>extends</span> B <span style=color:green;font-weight:700>with</span> C  <span style=color:#408080;font-style:italic>// error: illegal inheritance;
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>D</span> <span style=color:green;font-weight:700>extends</span> A <span style=color:green;font-weight:700>with</span> C
</span></span></code></pre></div><p>其次，值得注意的是 <code>C</code> 中定义了一个包含 <code>super</code> 的方法。这个定义在传统的面向对象模式中比较奇怪，如果是一个类，我们可以明确地知道 <code>super</code> 指向哪一个类的哪一个方法，而对于 <code>interface</code> 来说则不能。这体现了 Scala 中 trait 可堆叠的特性。类的 <code>super</code> 是静态绑定的，而 trait 中的 <code>super</code> 则是动态绑定的。这也是为什么这个方法的标签为 <code>override</code>。另外，我们也可以直接在定义 <code>object</code> 时混入 trait，甚至在 <code>new</code> 一个对象时混入：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>object</span> <span style=color:#00f;font-weight:700>o</span> <span style=color:green;font-weight:700>extends</span> A <span style=color:green;font-weight:700>with</span> C
</span></span><span style=display:flex><span>o f <span style=color:#ba2121>&#34;abc&#34;</span>               <span style=color:#408080;font-style:italic>// abc from trait C from class A
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> A <span style=color:green;font-weight:700>with</span> C<span style=color:#666>)</span> f <span style=color:#ba2121>&#34;abc&#34;</span>  <span style=color:#408080;font-style:italic>// abc from trait C from class A
</span></span></span></code></pre></div><p>接下来我们来<strong>堆叠</strong> trait。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>D</span> <span style=color:green;font-weight:700>extends</span> A <span style=color:#666>{</span> <span style=color:green;font-weight:700>abstract</span> <span style=color:green;font-weight:700>override</span> <span style=color:green;font-weight:700>def</span> f<span style=color:#666>(</span>s<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>=</span> <span style=color:green;font-weight:700>super</span><span style=color:#666>.</span>f<span style=color:#666>(</span>s <span style=color:#666>+</span> <span style=color:#ba2121>&#34; from trait D&#34;</span><span style=color:#666>)</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> A <span style=color:green;font-weight:700>with</span> C <span style=color:green;font-weight:700>with</span> D<span style=color:#666>)</span> f <span style=color:#ba2121>&#34;abc&#34;</span> <span style=color:#408080;font-style:italic>// abc from trait D from trait C from class A
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:#666>(</span><span style=color:green;font-weight:700>new</span> A <span style=color:green;font-weight:700>with</span> D <span style=color:green;font-weight:700>with</span> C<span style=color:#666>)</span> f <span style=color:#ba2121>&#34;abc&#34;</span> <span style=color:#408080;font-style:italic>// abc from trait C from trait D from class A
</span></span></span></code></pre></div><p>基本上来说，<code>super</code> 的顺序取决于混入的顺序。换句话说，在处理多重继承问题时，混入的顺序就决定了方法动态绑定时线性化的顺序。在多重继承这个问题上，Java 的做法是，类优先于接口的默认方法，两个接口的默认方法的冲突则会报错。在 Scala 中，两个 trait，或一个 trait 和一个类中的普通方法相遇时也会报错，而对于有父类的 trait 中的 <code>abstract override</code> 方法，则能够通过这种方式来扩展功能。举个这样的例子：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>abstract</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>IntItem</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>def</span> get<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span><span style=color:#666>;</span> <span style=color:green;font-weight:700>def</span> put<span style=color:#666>(</span>x<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span><span style=color:#666>)</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>DoubleItem</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>IntItem</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>abstract</span> <span style=color:green;font-weight:700>override</span> <span style=color:green;font-weight:700>def</span> put<span style=color:#666>(</span>x<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>=</span> <span style=color:green;font-weight:700>super</span><span style=color:#666>.</span>put<span style=color:#666>(</span><span style=color:#666>2</span> <span style=color:#666>*</span> x<span style=color:#666>)</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>PlusOneItem</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>IntItem</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>abstract</span> <span style=color:green;font-weight:700>override</span> <span style=color:green;font-weight:700>def</span> put<span style=color:#666>(</span>x<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>=</span> <span style=color:green;font-weight:700>super</span><span style=color:#666>.</span>put<span style=color:#666>(</span><span style=color:#666>1</span> <span style=color:#666>+</span> x<span style=color:#666>)</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>BasicIntItem</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>IntItem</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>private</span> <span style=color:green;font-weight:700>var</span> i<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span> <span style=color:#666>=</span> <span style=color:#666>0</span><span style=color:#666>;</span> <span style=color:green;font-weight:700>def</span> get <span style=color:green;font-weight:700>=</span> i<span style=color:#666>;</span> <span style=color:green;font-weight:700>def</span> put<span style=color:#666>(</span>x<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>=</span> <span style=color:#666>{</span>i <span style=color:green;font-weight:700>=</span> x<span style=color:#666>}</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>val</span> a <span style=color:green;font-weight:700>=</span> <span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>BasicIntItem</span> <span style=color:green;font-weight:700>with</span> <span style=color:#00f;font-weight:700>DoubleItem</span> <span style=color:green;font-weight:700>with</span> <span style=color:#00f;font-weight:700>PlusOneItem</span>
</span></span><span style=display:flex><span>a<span style=color:#666>.</span>put<span style=color:#666>(</span><span style=color:#666>2</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>a<span style=color:#666>.</span>get  <span style=color:#408080;font-style:italic>// 6
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>val</span> b <span style=color:green;font-weight:700>=</span> <span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>BasicIntItem</span> <span style=color:green;font-weight:700>with</span> <span style=color:#00f;font-weight:700>PlusOneItem</span> <span style=color:green;font-weight:700>with</span> <span style=color:#00f;font-weight:700>DoubleItem</span>
</span></span><span style=display:flex><span>b<span style=color:#666>.</span>put<span style=color:#666>(</span><span style=color:#666>2</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>b<span style=color:#666>.</span>get  <span style=color:#408080;font-style:italic>// 5
</span></span></span></code></pre></div><p>在这个例子里，因为父类 <code>IntItem</code> 是一个抽象类，所以 trait 中的类也要一起声明为抽象类（因为其中的 <code>super.put</code> 方法还是抽象的）。然后，我们提供了一个实现 <code>BasicIntItem</code>。这样，就能体现出 trait 中方法的动态绑定，<code>super.put</code> 最终被绑定到了 <code>BasicIntItem.put</code> 上去。然后，可以看到由于混入顺序的不同，方法的调用顺序不同，最终产生的逻辑也不同。如果我们在方法中加入的功能是可以<strong>堆叠</strong>的，就应该考虑这类方法。</p><h2 id=细节和使用>细节和使用
<a class=anchor href=#%e7%bb%86%e8%8a%82%e5%92%8c%e4%bd%bf%e7%94%a8>#</a></h2><p>首先来讨论一下什么时候应该使用特质。首先，如果一个特性可以出现在一些互相关系并不大的类的类中时，特质通常是一个比抽象类更好地选择。这和"抽象类描述本质而接口描述功能"的想法是统一的。另外，在分发代码或者和 Java 协作是也要考虑。Java 可以自如地继承 Scala 类，继承特质就比较麻烦。例外是，完全抽象没有实现体的特质会直接被翻译成接口，所以这种没有问题。此外，在分发代码时，如果特质发生了改变，其下游的类需要跟随进行重新编译。所以如果一个接口可能被下游继承实现，抽象类可能是更好的选择。</p><p>堆叠这种方式是解决多重继承的其中一个解决办法，可以参考 Python 使用的 <a href=https://zh.wikipedia.org/wiki/C3%E7%BA%BF%E6%80%A7%E5%8C%96>C3 线性化</a>来更好地理解它。由于 Scala使用了单继承 + trait 的方式，类的线性化方式比 C3 要简单。在 Java 中遇到方法冲突时，或者是 Scala 中的非 <code>override</code> 方法发生冲突时，我们会采用这样的方式：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:green;font-weight:700>interface</span> <span style=color:#00f;font-weight:700>B</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>default</span> <span style=color:#b00040>void</span> <span style=color:#00f>f</span><span style=color:#666>(</span>String s<span style=color:#666>)</span> <span style=color:#666>{</span> System<span style=color:#666>.</span><span style=color:#7d9029>out</span><span style=color:#666>.</span><span style=color:#7d9029>println</span><span style=color:#666>(</span>s <span style=color:#666>+</span> <span style=color:#ba2121>&#34; from interface B&#34;</span><span style=color:#666>);</span> <span style=color:#666>}</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>interface</span> <span style=color:#00f;font-weight:700>C</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>public</span> <span style=color:green;font-weight:700>default</span> <span style=color:#b00040>void</span> <span style=color:#00f>f</span><span style=color:#666>(</span>String s<span style=color:#666>)</span> <span style=color:#666>{</span> System<span style=color:#666>.</span><span style=color:#7d9029>out</span><span style=color:#666>.</span><span style=color:#7d9029>println</span><span style=color:#666>(</span>s <span style=color:#666>+</span> <span style=color:#ba2121>&#34; from interface C&#34;</span><span style=color:#666>);</span> <span style=color:#666>}</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>D</span> <span style=color:green;font-weight:700>implements</span> B<span style=color:#666>,</span> C <span style=color:#666>{}</span>  <span style=color:#408080;font-style:italic>// ERROR, method conflict, won&#39;t compile
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>D</span> <span style=color:green;font-weight:700>implements</span> B<span style=color:#666>,</span> C <span style=color:#666>{</span> <span style=color:green;font-weight:700>public</span> <span style=color:#b00040>void</span> <span style=color:#00f>f</span><span style=color:#666>(</span>String s<span style=color:#666>)</span> <span style=color:#666>{</span> System<span style=color:#666>.</span><span style=color:#7d9029>out</span><span style=color:#666>.</span><span style=color:#7d9029>println</span><span style=color:#666>(</span>s <span style=color:#666>+</span> <span style=color:#ba2121>&#34; from class D&#34;</span><span style=color:#666>);</span> <span style=color:#666>}</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>new</span> D<span style=color:#666>().</span><span style=color:#7d9029>f</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>)</span> <span style=color:#408080;font-style:italic>// abc from class D
</span></span></span></code></pre></div><p>或者在 Scala 里：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>A</span> <span style=color:#666>{</span><span style=color:green;font-weight:700>def</span> f <span style=color:green;font-weight:700>=</span> <span style=color:#666>1</span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>B</span> <span style=color:#666>{</span><span style=color:green;font-weight:700>def</span> f <span style=color:green;font-weight:700>=</span> <span style=color:#666>2</span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>C</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>new</span> C <span style=color:green;font-weight:700>with</span> A <span style=color:green;font-weight:700>with</span> B <span style=color:#666>{</span> <span style=color:green;font-weight:700>override</span> <span style=color:green;font-weight:700>def</span> f <span style=color:green;font-weight:700>=</span> <span style=color:#666>3</span> <span style=color:#666>}.</span>f  <span style=color:#408080;font-style:italic>// 3
</span></span></span></code></pre></div><p>和堆叠 trait 相比，这样的方式很难同时继承两个接口方法的功能。除非你能够把两个方法都重新实现一次，如果我们写出这样的方法（伪代码）：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>A</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>def</span> f<span style=color:#666>(</span>s<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>=</span> println<span style=color:#666>(</span>s <span style=color:#666>+</span> <span style=color:#ba2121>&#34; from A&#34;</span><span style=color:#666>)</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>B</span> <span style=color:green;font-weight:700>extends</span> A <span style=color:#666>{</span> <span style=color:green;font-weight:700>override</span> <span style=color:green;font-weight:700>def</span> f<span style=color:#666>(</span>s<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span> <span style=color:#666>=</span> <span style=color:green;font-weight:700>super</span><span style=color:#666>(</span>s <span style=color:#666>+</span> <span style=color:#ba2121>&#34; from B&#34;</span><span style=color:#666>))</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>C</span> <span style=color:green;font-weight:700>extends</span> A <span style=color:#666>{</span> <span style=color:green;font-weight:700>override</span> <span style=color:green;font-weight:700>def</span> f<span style=color:#666>(</span>s<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span> <span style=color:#666>=</span> <span style=color:green;font-weight:700>super</span><span style=color:#666>(</span>s <span style=color:#666>+</span> <span style=color:#ba2121>&#34; from C&#34;</span><span style=color:#666>))</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>object</span> <span style=color:#00f;font-weight:700>o</span> <span style=color:green;font-weight:700>extends</span> A <span style=color:green;font-weight:700>with</span> B <span style=color:green;font-weight:700>with</span> C <span style=color:#666>(</span> <span style=color:green;font-weight:700>override</span> <span style=color:green;font-weight:700>def</span> f<span style=color:#666>(</span>s<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>String</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>=</span> <span style=color:#666>{</span> B<span style=color:#666>.</span><span style=color:green;font-weight:700>super</span><span style=color:#666>(</span>s<span style=color:#666>);</span> C<span style=color:#666>.</span><span style=color:green;font-weight:700>super</span><span style=color:#666>(</span>s<span style=color:#666>)})</span>
</span></span><span style=display:flex><span>o<span style=color:#666>.</span>f<span style=color:#666>(</span><span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>// abc from B from A
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>// abc from C from A
</span></span></span></code></pre></div><p>由于这里的菱形继承关系，父类 <code>A</code> 的方法会被调用两次，这是我们不想看到的。</p><h2 id=线性化规则>线性化规则
<a class=anchor href=#%e7%ba%bf%e6%80%a7%e5%8c%96%e8%a7%84%e5%88%99>#</a></h2><p>最后我们来谈谈线性化的规则。相比 Python 或 C++ 这种支持多继承的语言，单继承 + 接口的语言的线性化要简单一些。基本的原则是，一个类型的线性化的后半部分是其父类的线性化。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Animal</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>Furry</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>Animal</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>HasLegs</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>Animal</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>trait</span> <span style=color:#00f;font-weight:700>FourLegged</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>HasLegs</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Cat</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>Animal</span> <span style=color:green;font-weight:700>with</span> <span style=color:#00f;font-weight:700>Furry</span> <span style=color:green;font-weight:700>with</span> <span style=color:#00f;font-weight:700>FourLegged</span>
</span></span></code></pre></div><p>于是根据这个规则我们有：</p><p><img src="https://g.gravizo.com/svg?%20digraph%20G%20%7B%20rankdir=BT%20Animal%20-%3E%20AnyRef%20-%3E%20Any%20Furry%20-%3E%20Animal%20HasLegs%20-%3E%20Animal%20FourLegged%20-%3E%20HasLegs%20Cat%20-%3E%20FourLegged%20Cat%20-%3E%20Furry%20Cat%20-%3E%20Animal%20%7D" alt="inheritance graph"></p><p><code>Animal</code>、<code>Furry</code> 和 <code>Four</code> 的线性化显而易见。对于 Cats，按照 trait 混入的顺序。<code>Furry</code> 第一个被混入，因此也第一个线性化，得到 <code>Furry -> Animal -> AnyRef -> Any</code>。然后混入 <code>FourLegged</code>，得到 <code>FourLegged -> HasLegs -> Furry -> Animal -> AnyRef -> Any</code>，最后线性化 <code>Cats</code> 本身，这个顺序也就是 <code>super</code> 的查找顺序。</p><h1 id=包和访问>包和访问
<a class=anchor href=#%e5%8c%85%e5%92%8c%e8%ae%bf%e9%97%ae>#</a></h1><h2 id=包>包
<a class=anchor href=#%e5%8c%85>#</a></h2><p>可以在一个文件里使用多个包：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>com</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>example</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>a</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>A</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>b</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>B</span><span style=color:#666>(</span><span style=color:green;font-weight:700>val</span> v<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>a.A</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>C</span><span style=color:#666>(</span><span style=color:green;font-weight:700>val</span> v<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>D</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>D</span>
</span></span></code></pre></div><p>上面的代码生成了四个类：<code>com.example.D</code> <code>com.example.a.A</code> <code>com.example.b.B</code> <code>com.example.b.C</code>。而且，在同一个包里的类可以简略地互相访问。只有嵌套起来的包才可以这样去访问，这是符合直觉的，比如：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>a</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>A</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>a.b</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>B</span><span style=color:#666>(</span><span style=color:green;font-weight:700>val</span> v<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span><span style=color:#666>)</span> <span style=color:#666>}</span>  <span style=color:#408080;font-style:italic>// Syntax Error, Won&#39;t Compile
</span></span></span></code></pre></div><p>如果不规定的话，最外层的包名为 <code>__root__</code>。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>object</span> <span style=color:#00f;font-weight:700>A</span>  <span style=color:#408080;font-style:italic>// __root__.A
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>a</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>object</span> <span style=color:#00f;font-weight:700>A</span> <span style=color:#666>}</span>  <span style=color:#408080;font-style:italic>// a.A
</span></span></span></code></pre></div><p>除此之外，还可以定义包对象，通常用于定义一些 Util 函数。这里的函数在整个包都能访问到。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#408080;font-style:italic>// in file com/example/package.scala
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>object</span> example <span style=color:#666>{</span> <span style=color:green;font-weight:700>def</span> fun <span style=color:green;font-weight:700>=</span> <span style=color:#666>...</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>// another file
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>com.example.fun</span>
</span></span><span style=display:flex><span><span style=color:#666>...</span>
</span></span></code></pre></div><h2 id=引入>引入
<a class=anchor href=#%e5%bc%95%e5%85%a5>#</a></h2><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>com.example.a</span>              <span style=color:#408080;font-style:italic>// only the package
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>com.example.a.</span><span style=color:#666>{</span>A<span style=color:#666>,</span> B<span style=color:#666>}</span>       <span style=color:#408080;font-style:italic>// two objects
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>com.example.a.A._</span>          <span style=color:#408080;font-style:italic>// all in the object A
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>com.example.a._</span>            <span style=color:#408080;font-style:italic>// all objects in package a
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>com.example.a.</span><span style=color:#666>{</span>A <span style=color:green;font-weight:700>=&gt;</span> C<span style=color:#666>,</span> B<span style=color:#666>}</span>  <span style=color:#408080;font-style:italic>// rename A to C
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>Laptops._</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>Fruits.</span><span style=color:#666>{</span><span style=color:#00f;font-weight:700>Apple</span> <span style=color:green;font-weight:700>=&gt;</span> <span style=color:green;font-weight:700>_</span><span style=color:#666>,</span> <span style=color:green;font-weight:700>_</span><span style=color:#666>}</span>  <span style=color:#408080;font-style:italic>// all in the Laptops, and all except Apple in Fruits
</span></span></span></code></pre></div><p>Scala 环境默认引入了一些变量，后引入的会覆盖先引入的。例如，<code>scala.StringBuilder</code> 会覆盖掉 <code>java.lang.StringBuilder</code>。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>java.lang._</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>scala._</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>Predef._</span>
</span></span></code></pre></div><h2 id=访问控制>访问控制
<a class=anchor href=#%e8%ae%bf%e9%97%ae%e6%8e%a7%e5%88%b6>#</a></h2><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Outer</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Inner</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>private</span> <span style=color:green;font-weight:700>def</span> f <span style=color:green;font-weight:700>=</span> <span style=color:#666>1</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>Inner</span><span style=color:#666>().</span>f  <span style=color:#408080;font-style:italic>// works in Java, not in Scala
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:#666>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>example</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Super</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>protected</span> <span style=color:green;font-weight:700>def</span> fun <span style=color:green;font-weight:700>=</span> <span style=color:#666>1</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Another</span><span style=color:#666>{</span> <span style=color:green;font-weight:700>def</span> fun <span style=color:green;font-weight:700>=</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>new</span> <span style=color:#00f;font-weight:700>Super</span><span style=color:#666>().</span>fun <span style=color:#666>}</span> <span style=color:#666>}</span>  <span style=color:#408080;font-style:italic>// works in Java(protected in same package), not in Scala
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:#666>}</span>
</span></span></code></pre></div><p>Scala 的成员是默认公共的。除了上述两条比 Java 更合理的限制之外，Scala 还提供了更细致的访问控制。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>com</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>package</span> <span style=color:#00f;font-weight:700>example</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Clazz</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>private</span><span style=color:#666>[</span><span style=color:#b00040>com</span><span style=color:#666>]</span> <span style=color:green;font-weight:700>def</span> fun <span style=color:green;font-weight:700>=</span> <span style=color:#666>0</span>      <span style=color:#408080;font-style:italic>// accessible for all in com and subpackages of com
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  <span style=color:green;font-weight:700>private</span><span style=color:#666>[</span><span style=color:#b00040>example</span><span style=color:#666>]</span> <span style=color:green;font-weight:700>def</span> fun <span style=color:green;font-weight:700>=</span> <span style=color:#666>0</span>  <span style=color:#408080;font-style:italic>// same as default in java
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  <span style=color:green;font-weight:700>private</span><span style=color:#666>[</span><span style=color:#b00040>Clazz</span><span style=color:#666>]</span> <span style=color:green;font-weight:700>def</span> fun <span style=color:green;font-weight:700>=</span> <span style=color:#666>2</span>    <span style=color:#408080;font-style:italic>// same as private in java
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Inner</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>private</span><span style=color:#666>[</span><span style=color:#b00040>Inner</span><span style=color:#666>]</span> <span style=color:green;font-weight:700>def</span> fun <span style=color:green;font-weight:700>=</span> <span style=color:#666>3</span>  <span style=color:#408080;font-style:italic>// same as private in scala
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>private</span><span style=color:#666>[</span><span style=color:#b00040>this</span><span style=color:#666>]</span> <span style=color:green;font-weight:700>def</span> fun <span style=color:green;font-weight:700>=</span> <span style=color:#666>4</span>   <span style=color:#408080;font-style:italic>// only in this object
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span></code></pre></div><p>最后一个问题是伴生对象。理论上来说，伴生对象和它伴生的类是两个不同的类型（type）。不过显然这两者应该共享访问控制才合适，Scala 也是这么做的。对单例对象来说 <code>protected</code> 没有意义。</p><h1 id=断言>断言
<a class=anchor href=#%e6%96%ad%e8%a8%80>#</a></h1><p>断言有两种形式，一种是随时加入的传统断言，另一种是在返回结果之前进行的检查。断言接收第二个 <code>Any</code> 类型的参数，调用 <code>toString</code> 将结果作为错误信息显示。</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:green;font-weight:700>def</span> f<span style=color:#666>(</span>a<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span><span style=color:#666>,</span> b<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Int</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>=</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  assert<span style=color:#666>(</span>a <span style=color:#666>&gt;</span> <span style=color:#666>0</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>  a <span style=color:#666>+</span> b
</span></span><span style=display:flex><span><span style=color:#666>}</span> ensuring<span style=color:#666>(</span>a <span style=color:#666>&lt;</span> <span style=color:green;font-weight:700>_</span><span style=color:#666>,</span> <span style=color:#ba2121>&#34;abc&#34;</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>f<span style=color:#666>(-</span><span style=color:#666>1</span><span style=color:#666>,</span> <span style=color:#666>1</span><span style=color:#666>)</span>  <span style=color:#408080;font-style:italic>//java.lang.AssertionError: assertion failed
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>f<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>,</span> <span style=color:#666>-</span><span style=color:#666>1</span><span style=color:#666>)</span>  <span style=color:#408080;font-style:italic>// java.lang.AssertionError: assertion failed: abc
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>f<span style=color:#666>(</span><span style=color:#666>1</span><span style=color:#666>,</span> <span style=color:#666>1</span><span style=color:#666>)</span>
</span></span></code></pre></div><p><code>ensuring</code> 的实现大致是这样的：</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-scala data-lang=scala><span style=display:flex><span><span style=color:#a2f>@elidable</span><span style=color:#666>(</span><span style=color:#00f;font-weight:700>ASSERTION</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>def</span> assert<span style=color:#666>(</span>assertion<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Unit</span> <span style=color:#666>=</span> <span style=color:#666>{</span> <span style=color:green;font-weight:700>if</span> <span style=color:#666>(!</span>assertion<span style=color:#666>)</span> <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>AssertionError</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;assertion failed&#34;</span><span style=color:#666>)</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f>@elidable</span><span style=color:#666>(</span><span style=color:#00f;font-weight:700>ASSERTION</span><span style=color:#666>)</span> <span style=color:#a2f>@inline</span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>final</span> <span style=color:green;font-weight:700>def</span> assert<span style=color:#666>(</span>assertion<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span><span style=color:#666>,</span> message<span style=color:green;font-weight:700>:</span> <span style=color:#666>=&gt;</span> <span style=color:#00f;font-weight:700>Any</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Unit</span> <span style=color:#666>=</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>if</span> <span style=color:#666>(!</span>assertion<span style=color:#666>)</span> <span style=color:green;font-weight:700>throw</span> <span style=color:green;font-weight:700>new</span> java<span style=color:#666>.</span>lang<span style=color:#666>.</span><span style=color:#00f;font-weight:700>AssertionError</span><span style=color:#666>(</span><span style=color:#ba2121>&#34;assertion failed: &#34;</span><span style=color:#666>+</span> message<span style=color:#666>)</span> <span style=color:#666>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>implicit</span> <span style=color:green;font-weight:700>final</span> <span style=color:green;font-weight:700>class</span> <span style=color:#00f;font-weight:700>Ensuring</span><span style=color:#666>[</span><span style=color:#b00040>A</span><span style=color:#666>](</span><span style=color:green;font-weight:700>private</span> <span style=color:green;font-weight:700>val</span> self<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span><span style=color:#666>)</span> <span style=color:green;font-weight:700>extends</span> <span style=color:#00f;font-weight:700>AnyVal</span> <span style=color:#666>{</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> ensuring<span style=color:#666>(</span>cond<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span> <span style=color:#666>=</span> <span style=color:#666>{</span> assert<span style=color:#666>(</span>cond<span style=color:#666>);</span> self <span style=color:#666>}</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> ensuring<span style=color:#666>(</span>cond<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>Boolean</span><span style=color:#666>,</span> msg<span style=color:green;font-weight:700>:</span> <span style=color:#666>=&gt;</span> <span style=color:#00f;font-weight:700>Any</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span> <span style=color:#666>=</span> <span style=color:#666>{</span> assert<span style=color:#666>(</span>cond<span style=color:#666>,</span> msg<span style=color:#666>);</span> self <span style=color:#666>}</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> ensuring<span style=color:#666>(</span>cond<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span> <span style=color:#666>=&gt;</span> <span style=color:#00f;font-weight:700>Boolean</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span> <span style=color:#666>=</span> <span style=color:#666>{</span> assert<span style=color:#666>(</span>cond<span style=color:#666>(</span>self<span style=color:#666>));</span> self <span style=color:#666>}</span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>def</span> ensuring<span style=color:#666>(</span>cond<span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span> <span style=color:#666>=&gt;</span> <span style=color:#00f;font-weight:700>Boolean</span><span style=color:#666>,</span> msg<span style=color:green;font-weight:700>:</span> <span style=color:#666>=&gt;</span> <span style=color:#00f;font-weight:700>Any</span><span style=color:#666>)</span><span style=color:green;font-weight:700>:</span> <span style=color:#b00040>A</span> <span style=color:#666>=</span> <span style=color:#666>{</span> assert<span style=color:#666>(</span>cond<span style=color:#666>(</span>self<span style=color:#666>),</span> msg<span style=color:#666>);</span> self <span style=color:#666>}</span>
</span></span><span style=display:flex><span><span style=color:#666>}</span>
</span></span></code></pre></div><p>也就是说，返回值被隐式转换为了一个 <code>Ensuring</code> 对象，这个对象有一个 <code>ensuring</code> 方法来接收这些参数，并进一步调用 <code>assert</code>。</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(n){const e=window.getSelection(),t=document.createRange();t.selectNodeContents(n),e.removeAllRanges(),e.addRange(t)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#scala-的层级>Scala 的层级</a><ul><li><a href=#scala-继承层级>Scala 继承层级</a></li><li><a href=#自定义值类型>自定义值类型</a></li><li><a href=#相等性>相等性</a></li></ul></li><li><a href=#特质-trait>特质 Trait</a><ul><li><a href=#trait>Trait</a></li><li><a href=#瘦接口-vs-胖接口>瘦接口 VS 胖接口</a></li><li><a href=#混入>混入</a></li><li><a href=#细节和使用>细节和使用</a></li><li><a href=#线性化规则>线性化规则</a></li></ul></li><li><a href=#包和访问>包和访问</a><ul><li><a href=#包>包</a></li><li><a href=#引入>引入</a></li><li><a href=#访问控制>访问控制</a></li></ul></li><li><a href=#断言>断言</a></li></ul></nav></div></aside></main></body></html>